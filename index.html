<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“¸ Captura con Marco + QR</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <h1>ğŸ“¸ Captura con Marco + QR</h1>
  <div class="container">
    <canvas id="previewCanvas"></canvas>
    <div class="controls">
      <button id="capturar">ğŸ“· Capturar</button>
      <button id="descargar">â¬‡ï¸ Descargar</button>
      <button id="subir">â˜ï¸ Subir</button>
      <div id="qr"></div>
      <div id="frameGallery"></div>
    </div>
  </div>

  <video id="video" autoplay playsinline></video>

  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <script>
    async function activarVersionLite() {
      const ua = navigator.userAgent;
      const isAndroid9 = ua.includes("Android 9");
      const lacksCamera = !navigator.mediaDevices?.getUserMedia;
      const lacksBlob = !HTMLCanvasElement.prototype.toBlob;

      let isIncognito = false;
      let cameraDenied = false;

      try {
        const { quota } = await navigator.storage.estimate();
        if (quota && quota < 120 * 1024 * 1024) isIncognito = true;
      } catch {}

      try {
        const status = await navigator.permissions.query({ name: 'camera' });
        if (status.state === 'denied') cameraDenied = true;
      } catch {}

      const usarLite = isAndroid9 || lacksCamera || lacksBlob || isIncognito || cameraDenied;

      if (usarLite) {
        document.write('<script src="script-lite.js"><\/script>');
        document.write(`
          <div style="background:#222;padding:10px;color:#ff0;text-align:center;">
            âš ï¸ EstÃ¡s usando la versiÃ³n Lite por compatibilidad.
            ${isAndroid9 ? "<br>ğŸ“± Android 9 detectado." : ""}
            ${isIncognito ? "<br>ğŸ”’ Modo incÃ³gnito activo." : ""}
            ${cameraDenied ? "<br>ğŸš« Permisos de cÃ¡mara bloqueados." : ""}
          </div>
        `);
      } else {
        document.write('<script src="script.js"><\/script>');
      }
    }

    activarVersionLite();
  </script>
</body>
</html>